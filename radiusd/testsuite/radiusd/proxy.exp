# -*- tcl -*-
# This file is part of GNU Radius testsuite.
# Copyright (C) 2000,2001,2002,2003,2004 Free Software Foundation, Inc.
#
# Written by Sergey Poznyakoff
# 
# GNU Radius is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# GNU Radius is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with GNU Radius; if not, write to the Free Software Foundation,
# Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.

default_radiusd_start --proxy

#clone_output "Checking Proxy Basic Authentication Types"
radius_test "send auth Access-Request User-Name = \"accept@remote\"" \
            "expect Access-Accept"  
radius_test "send auth Access-Request User-Name = \"reject@remote\"" \
            "expect Access-Reject"  
radius_test "send auth Access-Request User-Name = \"local@remote\" User-Password = \"guessme\"" \
            "expect Access-Accept" 
radius_test "send auth Access-Request User-Name = \"local@remote\" User-Password = \"bad\"" \
            "expect Access-Reject" 
radius_test "send auth Access-Request User-Name = \"crypt@remote\" User-Password = \"hamlet\"" \
            "expect Access-Accept" 
radius_test "send auth Access-Request User-Name = \"chap@remote\" \
             CHAP-Password = \"\\001\\357\\213\\343\\126\\266\\311\\072\\202\\020\\176\\017\\121\\101\\227\\155\\244\" \
             CHAP-Challenge = \"0123456789abcdef\"" \
             "expect Access-Accept"

radius_test "send auth Access-Request User-Name = \"accept@iGnoReCaSE\"" \
            "expect Access-Accept"  

radius_test "send auth Access-Request User-Name = \"vsa-propagation@remote\""\
            "expect Access-Accept Cisco-AVPair = \"variable=value\""

#clone_output "Checking Menus"

radius_test -prereq USE_LIVINGSTON_MENUS\
	    "send auth Access-Request User-Name = \"menu\"" \
	    "print \$REPLY\[Reply-Message*\]" \
	    "MENU1(1-PPP, 2-CSLIP, 3-SLIP, 4-Login, 5-Second, 6-Exit)"
radius_test -prereq USE_LIVINGSTON_MENUS\
	    "send auth Access-Request User-Name = \"menu\" \
                  User-Password = \"5\" \
		  State = \"MENU=menu1\"" \
		  "print \$REPLY\[Reply-Message*\]" \
		  "MENU2(ra,sol,weevil,top,quit)"
radius_test -prereq USE_LIVINGSTON_MENUS\
	    "send auth Access-Request User-Name = \"menu\" \
                  User-Password = \"sol\" \
                  State = \"MENU=menu2\"" \
            "expect Access-Accept Service-Type = 1 \
                  Login-IP-Host = 127.0.0.1 \
                  State = \"MENU=menu2\" \
                  Termination-Action = 1" 

#clone_output "Checking Nested Realms"
radius_test "send auth Access-Request User-Name = \"accept@local@remote\"" \
            "expect Access-Accept" 

#clone_output "Checking Proxy Accountng Start"
radius_test "send acct Accounting-Request User-Name = \"simuse@remote\" \
                    NAS-IP-Address = 127.0.0.1 \
                    NAS-Port-Id = 1 \
                    Acct-Session-Id = \"0001\" \
                    Acct-Status-Type = Start" \
            "expect Accounting-Response" 

#clone_output "Checking Proxy Accountng Stop"
radius_test "send acct Accounting-Request User-Name = \"simuse@remote\" \
                    NAS-IP-Address = 127.0.0.1 \
                    NAS-Port-Id = 1 \
                    Acct-Session-Id = \"0001\" \
                    Acct-Status-Type = Stop" \
            "expect Accounting-Response" 

radius_test "send auth Access-Request User-Name = \"tunnel\" \
                         User-Password = \"test\"" \
            "expect Access-Accept Service-Type = Framed-User \
		       Framed-Protocol = PPTP \
		       Tunnel-Password = tUnnEl"


radius_exit
